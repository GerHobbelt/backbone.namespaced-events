/*! Backbone namespaced events - v0.1.0 - 2013-01-24
* https://github.com/wheresrhys/backbone.namespaced-events
* Copyright (c) 2013 Rhys Evans; Licensed MIT */
(function(e){"use strict";var t,n,r;typeof window=="undefined"?(t=require("underscore"),n=require("backbone"),r=module.exports=n):(t=window._,n=window.Backbone,r=window);var i=[],s=i.push,o=i.slice,u=i.splice,a=function(e,t,n,r){if(!n)return!0;if(typeof n=="object")for(var i in n)e[t].apply(e,[i,n[i]].concat(r));else{if(!h.test(n))return!0;var s=n.split(h);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r))}},f=function(e,t){var n,r=-1,i=e.length;switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,t[0]);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,t[0],t[1]);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,t[0],t[1],t[2]);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},l=function(e){if(!e)return[];var t=e.__callbacks__.slice(),n;for(n in e)e.hasOwnProperty(n)&&n!=="__callbacks__"&&(t=t.concat(l(e[n])));return t},c=function(e,t,n){var r,i,s,o,u=e.__callbacks__,a=[];for(s=0,o=u.length;s<o;s++)i=u[s],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&a.push(i);e.__callbacks__=a;for(var f in e)e.hasOwnProperty(f)&&f!=="__callbacks__"&&c(e[f],t,n)},h=/\s+/,p=".",d=n.Events,v=n.NamespacedEvents={on:function(e,t,n){if(!a(this,"on",e,[t,n])||!t)return this;var r=this._events||(this._events={}),i=e.indexOf(p)>0?e.split(p):[e];while(e=i.shift())r=r[e]||(r[e]={__callbacks__:[]});return r.__callbacks__.push({callback:t,context:n,ctx:n||this}),this},off:function(e,n,r){var i,s,o,u,f,l,h,d,v;if(!this._events||!a(this,"off",e,[n,r]))return this;if(!e&&!n&&!r)return this._events={},this;f=e?[e]:t.keys(this._events);for(l=0,h=f.length;l<h;l++){e=f[l];if(e==="__callbacks__")continue;d=e.indexOf(p)>0?e.split(p):[e],i=this._events;while(e=d.shift()){v={list:i,name:e};if(!(i=i[e]))return this}n||r?c(i,n,r):delete v.list[v.name]}return this},trigger:function(e){if(!this._events)return this;var t=o.call(arguments,1);if(!a(this,"trigger",e,t))return this;var n=this._events,r=e.indexOf(p)>0?e.split(p):[e];while(e=r.shift())if(!(n=n[e])){n=null;break}n=l(n);var i=this._events.all&&this._events.all.__callbacks__.slice();return n&&f(n,t),i&&f(i,arguments),this},once:d.once,listenTo:d.listenTo,stopListening:d.stopListening,overwriteNativeEvents:function(){n.NativeEvents||(n.NativeEvents=n.Events,n.Events=v,t.extend(n,v),t.extend(n.Model.prototype,v),t.extend(n.Collection.prototype,v),t.extend(n.Router.prototype,v),t.extend(n.History.prototype,v))}};v.bind=v.on,v.unbind=v.off})();